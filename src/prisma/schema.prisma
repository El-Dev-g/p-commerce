// This is your Prisma schema file,
// learn more about it in the docs: https://pris.ly/d/prisma-schema

generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider = "postgresql"
  url      = env("DATABASE_URL")
}

model User {
  id        String   @id @default(cuid())
  email     String   @unique
  name      String?
  password  String
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}

model Product {
  id          String             @id @default(cuid())
  name        String
  nameB       String?
  description String             @db.Text
  price       Float
  category    String
  imageSrc    String
  imageAlt    String
  createdAt   DateTime           @default(now())
  updatedAt   DateTime           @updatedAt
  variations  ProductVariation[]
  OrderLine   OrderLine[]
}

model ProductVariation {
  id            String               @id @default(cuid())
  sku           String?              @unique
  stock         Int
  priceModifier Float                @default(0)
  product       Product              @relation(fields: [productId], references: [id])
  productId     String
  attributes    VariationAttribute[]
  OrderLine     OrderLine[]
}

model VariationAttribute {
  id         String           @id @default(cuid())
  name       String
  value      String
  variation  ProductVariation @relation(fields: [variationId], references: [id])
  variationId String
}

model Customer {
  id         String   @id @default(cuid())
  name       String
  email      String   @unique
  phone      String?
  totalSpent Float    @default(0)
  orderCount Int      @default(0)
  joinDate   DateTime @default(now())
  orders     Order[]
}

model Order {
  id             String      @id @default(cuid())
  status         String      @default("Processing")
  total          Float
  tags           String[]
  fraudRisk      String      @default("low")
  trackingNumber String?
  customer       Customer    @relation(fields: [customerId], references: [id])
  customerId     String
  createdAt      DateTime    @default(now())
  updatedAt      DateTime    @updatedAt
  lines          OrderLine[]
}

model OrderLine {
  id               String            @id @default(cuid())
  order            Order             @relation(fields: [orderId], references: [id])
  orderId          String
  product          Product           @relation(fields: [productId], references: [id])
  productId        String
  variation        ProductVariation? @relation(fields: [variationId], references: [id])
  variationId      String?
  quantity         Int
  priceAtPurchase  Float
}

model Page {
  id        String   @id @default(cuid())
  slug      String   @unique
  title     String
  content   Json
  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt
}
